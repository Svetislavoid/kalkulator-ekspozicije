<!DOCTYPE html>

<html>
    
  <head>
    <meta charset="UTF-8" />
      <title>Kalkulator ekspozicije</title>
<!--       <link rel="stylesheet" type="text/css" href="style.css">
      <script type="text/javascript" src="script.js"></script> -->
  </head>

  <style>

  * {
    font-size: 14px;
    font-family: sans-serif;
    box-sizing: border-box;
  }

  .wrapper {
    max-width: 1300px;
    min-width: 1100px;
    margin: 30px auto;
  }

  .form,
  .result {
    width: 48%;
    display: inline-block;
  }

  .result {
    vertical-align: top;
    float: right;
  }

  .result p {
    margin: 6px 0 6px 20px;
  }

  #canvas {
    display: block;
    /*border: 1px solid #333;*/
    margin: 15px auto 0;
  }

  fieldset {
    padding: 30px 40px;
  }

  legend {
    font-size: 24px;
  }

  .collapsed {
    /*display: none;*/
  }

  .parameters {
    position: relative;
    padding: 10px 20px;
  }

  .parameters:nth-child(odd) {
    background-color: #cde; 
  }

  label {
    display: inline-block;
    width: 60%;
    vertical-align: middle;
    padding-right: 20px;
  }

  label + * {
    width: 39%;
  }

  .submit {
    display: block;
    margin: 30px auto 0;
    border: none;
    height: 40px;
    width: 140px;
    background-color: #bbb;
  }

  .submit:hover {
    background-color: #999;
  }

  .bold {
    font-weight: 700;
  }

  .ekspozicija,
  .ekspozicija span {
    font-size: 18px;
    text-align: center;
  }

  </style>
    
  <body>

    <div class="wrapper">
            
      <form>
        <fieldset>
          <legend>Kalkulator ekspozicije</legend>

          <div class="form">
            <div class="parameters">
              <label for="teleskop">Teleskop:</label>
              <select class="teleskop" name="teleskop">
                <option value="60cm Cassegrain">60cm Cassegrain</option>
                <option value="1.4m Nasmyth">1.4m Nasmyth</option>
              </select>
            </div>

            <div class="parameters">
              <label for="ccd">CCD:</label>
              <select class="ccd" name="ccd">
                <option value="ANDOR iKonL">ANDOR iKonL</option>
                <option value="ANDOR iXon 897">ANDOR iXon 897</option>
                <option value="Apogee U42">Apogee U42</option>
                <option value="Apogee E47">Apogee E47</option>
                <option value="SBIG ST10XME">SBIG ST10XME</option>
              </select>
            </div>

            <div class="parameters">
              <label for="filter">Filter:</label>
              <select class="filter" name="filter">
                <option value="B">B</option>
                <option value="V">V</option>
                <option value="R">R</option>
                <option value="I">I</option>
                <option value="L">L</option>
                <option value="Ha">Ha</option>
                <option value="Ha-kontinuum">Ha-kontinuum</option>
                <option value="[SII]">[SII]</option>
              </select>
            </div>

            <div class="parameters">
              <label for="opseg">Opseg filtera:</label>
              <input class="opseg" type="text" list="opseg">
              <datalist id="opseg">
                <option value="400">400</option>
                <option value="600">600</option>
              </datalist>
            </div>

            <div class="parameters">
              <label for="transparentnost">Ukupna transparentnost na svim opti훾kim elementima:</label>
              <input class="transparentnost" type="text">
            </div>

            <div class="parameters">
              <label for="transparentnost-neba">Transparentnost neba:</label>
              <input class="transparentnost-neba" type="text">
            </div>

            <div class="parameters">
              <label for="sjaj-neba">Sjaj neba:</label>
              <input class="sjaj-neba" type="text">
            </div>

            <div class="parameters">
              <label for="magnituda">Magnituda:</label>
              <input class="magnituda" type="text">
            </div>

            <div class="parameters">
              <label for="signal-to-noise">S/N:</label>
              <input class="signal-to-noise" type="text">
            </div>
          
            <input type="button" class="submit" value="Ra훾unaj">
          </div>

          <div class="result collapsed">

            <p>Teleskop: <span class="r-teleskop bold"></span></p>
            <p>CCD: <span class="r-ccd bold"></span></p>
            <p>Filter: <span class="r-filter bold"></span></p>
            <p>Opseg filtera: <span class="r-opseg bold"></span></p>
            <p>Ukupna transparentnost na svim opti훾kim elementima: <span class="r-transparentnost bold"></span></p>
            <p>Transparentnost neba: <span class="r-transparentnost-neba bold"></span></p>
            <p>Sjaj neba: <span class="r-sjaj-neba bold"></span></p>
            <p>Magnituda: <span class="r-magnituda bold"></span></p>
            <p>S/N: <span class="r-signal-to-noise bold"></span></p>

            <p class="ekspozicija bold">Ekspozicija: t = <span>0</span>s</p>

            <canvas id="canvas" width="520" height="400"></canvas> 

          </div>
        </fieldset>

      </form>

    </div>

    <script>

      window.addEventListener('load', function() {

        var kalkulator = {

          broj_podeokaX: 0,
          broj_podeokaY: 0,
          podeokX: 45,
          podeokY: 45,

          init: function() {
            this.cacheDom();
            this.bindEvent('click', this.submit, this.execute.bind(this));
          },

          cacheDom: function() {
            this.teleskop = document.querySelector('.teleskop');
            this.ccd = document.querySelector('.ccd');
            this.filter = document.querySelector('.filter');
            this.opseg_filtera = document.querySelector('.opseg');
            this.transparentnost_elemenata = document.querySelector('.transparentnost');
            this.transparentnost_neba = document.querySelector('.transparentnost-neba');
            this.sjaj_neba = document.querySelector('.sjaj-neba');
            this.magnituda = document.querySelector('.magnituda');
            this.signal_to_noise = document.querySelector('.signal-to-noise');

            this.r_teleskop = document.querySelector('.r-teleskop');
            this.r_ccd = document.querySelector('.r-ccd');
            this.r_filter = document.querySelector('.r-filter');
            this.r_opseg_filtera = document.querySelector('.r-opseg');
            this.r_transparentnost_elemenata = document.querySelector('.r-transparentnost');
            this.r_transparentnost_neba = document.querySelector('.r-transparentnost-neba');
            this.r_sjaj_neba = document.querySelector('.r-sjaj-neba');
            this.r_magnituda = document.querySelector('.r-magnituda');
            this.r_signal_to_noise = document.querySelector('.r-signal-to-noise');

            this.ekspozicija = document.querySelector('.ekspozicija span');
            this.canvas = document.querySelector('#canvas');

            this.submit = document.querySelector('.submit');
            this.form = document.querySelector('.form');
            this.result = document.querySelector('.result');
          },

          execute: function() {
            this.logger();
            this.fillData();
            this.drawGraphLines();
            this.addGraphValues();
            this.result.classList.remove("collapsed");
          },

          fillData: function() {
            this.r_teleskop.innerHTML = this.teleskop.options[this.teleskop.selectedIndex].text;
            this.r_ccd.innerHTML = this.ccd.options[this.ccd.selectedIndex].text;
            this.r_filter.innerHTML = this.filter.options[this.filter.selectedIndex].text;
            this.r_opseg_filtera.innerHTML = this.opseg_filtera.value;
            this.r_transparentnost_elemenata.innerHTML = this.transparentnost_elemenata.value;
            this.r_transparentnost_neba.innerHTML = this.transparentnost_neba.value;
            this.r_sjaj_neba.innerHTML = this.sjaj_neba.value;
            this.r_magnituda.innerHTML = this.magnituda.value;
            this.r_signal_to_noise.innerHTML = this.signal_to_noise.value;

          },

          drawGraphLines: function() {
            var ctx = this.canvas.getContext("2d");
            var width = this.canvas.width;
            var height = this.canvas.height;

            ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
            this.broj_podeokaX = 0;
            this.broj_podeokaY = 0;

            // koordinatne linije
            // x-osa
            ctx.moveTo(15,height-25);
            ctx.lineTo(width-15,height-25);
            // y-osa
            ctx.moveTo(25,height-15);
            ctx.lineTo(25,22);

            // podeoci na x osi
            for (var i = 25 + this.podeokX; i < width; i += this.podeokX) {
              ctx.moveTo(i,height-25);
              ctx.lineTo(i,height-15);
              this.broj_podeokaX++;
            }

            // podeoci na y osi
            for (var j = height - 25 - this.podeokY; j > 20; j -= this.podeokY) {
              ctx.moveTo(25,j);
              ctx.lineTo(15,j);
              this.broj_podeokaY++;
            }

            ctx.stroke();

            // oznake koordinatnih osa
            ctx.font = "16px sans-serif";
            ctx.fillText("S/N",15,15);
            ctx.fillText("t",width-10,height-20);

            // koordinatni po훾etak
            ctx.font = "10px sans-serif";
            ctx.fillText("0",5,height-20);
            ctx.fillText("0",21,height-3);
          },

          addGraphValues: function() {
            var ctx = this.canvas.getContext("2d");
            var height = this.canvas.height;

            var m = 1;
            var sn = Math.ceil(this.signal_to_noise.value);
            var upLimitY = Math.ceil(sn*1.3);

            ctx.font = "10px sans-serif";

            if (upLimitY > this.broj_podeokaY) {
              while (upLimitY%this.broj_podeokaY !== 0) {
                upLimitY++;
              }
              for (var j = height - 25 - this.podeokY; j > 20; j -= this.podeokY) {
                ctx.moveTo(0,j);
                ctx.fillText(m*upLimitY/this.broj_podeokaY,0,j+10);
                m++;
              }
            } else {
              upLimitY = Math.ceil(sn*1.3);
              for (var j = height - 25 - this.podeokY; j > 20; j -= this.podeokY) {
                ctx.moveTo(0,j);
                ctx.fillText((m*upLimitY/this.broj_podeokaY).toFixed(2),0,j+10);
                m++;
              }
            }

          },

          logger: function() {
            console.log("Teleskop: " + this.teleskop.options[this.teleskop.selectedIndex].text);
            console.log("CCD: " + this.ccd.options[this.ccd.selectedIndex].text);
            console.log("Filter: " + this.filter.options[this.filter.selectedIndex].text);
            console.log("Opseg filtera: " + this.opseg_filtera.value);
            console.log("Transparentnost elemenata: " + this.transparentnost_elemenata.value);
            console.log("Transparentnost neba: " + this.transparentnost_neba.value);
            console.log("Sjaj neba: " + this.sjaj_neba.value);
            console.log("Magnituda: " + this.magnituda.value);
            console.log("S/N: " + this.signal_to_noise.value);
          },

          bindEvent: function(event, target, callback) {
            target.addEventListener(event, callback);
          }

        }

        // inicijalizacija
        kalkulator.init();

      });
  
    </script>
    
  </body>

</html>
